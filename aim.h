#pragma once
#include "Enemies.h"
#include "local.h"
#include <cstdint>
#include <Windows.h>


class Enemies* GetClosestEnemy()
{
	Local* localplayer = Local::Get();
	float closestDistance = 1000000;
	int closestDistanceIndex = -1; 

	for (int i = 1; i < *Enemies::GetMaxEnemies(); i++)
	{
		Enemies* current = Enemies::GetEnemies(i);
		if (!current || !(*(uint32_t*)current) || (uint32_t)current == (uint32_t)localplayer)
		{
			continue;

		}
		if (*current->GetTeam() == *localplayer->GetTeam())
		{
			continue;
		}
		if (*current->GetHealth() < 1 || *localplayer->GetHealth() < 1)
		{
			continue;

		}
		float currentDistance = localplayer->GetDistance(current->GetOrigin());
		if (currentDistance < closestDistance)
		{
			closestDistance = currentDistance;
			closestDistanceIndex = i;
		}


	}
	if (closestDistanceIndex == -1)
	{
		return NULL;

	}
	return Enemies::GetEnemies(closestDistanceIndex);
}



void Run()
{
	Enemies* closestEnemy = GetClosestEnemy();

	if (closestEnemy)
	{
		Local::Get()->AimAt(closestEnemy->GetBonePos(8));
	}
}